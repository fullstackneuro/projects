function s_clscng_make_and_smooth_roi_mat
%
% This script loads a NIFTI ROI, tranforms it into a mat ROI and 
% Applies some operations to it, such as smoothing, dilation and 
% removal of satellites.
%
% Copyright Franco Pestilli (c) Stanford University, 2014

datapath = '/media/lcne/matproc';
%datapath = '/media/storg/matproc';

subjects = {'am160914','kn160918','ld160918','li160927','ac160415','jh160702','jr160507', ...
            'mp160511','ps160508', 'al151016', 'jg151121', 'jv151030','ps151001','zl150930'};

%{          
storg            
'ab071412','bb160402','bk032113','bp160213', ...
'cs160214','dc050213','ds080712','en062813','gr051513','hm062513','jc160320', ...
 'jc160321','jl071912','jt062413', 'jw072512','jw160316', ...     
'lc052213','mk021913','ml061013','np072412','pk160319'                   
%}  
            
rois = {'lh_antcing_a2009s', 'rh_antcing_a2009s', ...
        'lh_midantcing_a2009s', 'rh_midantcing_a2009s', ...
        'lh_midpostcing_a2009s', 'rh_midpostcing_a2009s', ...
        'lh_dorspostcing_a2009s', 'rh_dorspostcing_a2009s', ...
        'lh_ventpostcing_a2009s', 'rh_ventpostcing_a2009s', ...
        'lh_wmmask_fs', 'rh_wmmask_fs'};
%{
rois = {'rh_nacc_aseg', ...
        'lh_nacc_aseg', ...
        'rh_frontorb_a2009s', ...
        'rh_frontinfang_a2009s', ...
        'rh_antins_a2009s', ...
        'rh_shortins_a2009s', ...
        'rh_nacc_aseg', ...
        'rh_latorb_a2009s', ...
        'rh_wmmask_fs', ...
        'lh_frontorb_a2009s', ...
        'lh_frontinfang_a2009s', ...
        'lh_antins_a2009s', ...
        'lh_shortins_a2009s', ...
        'lh_nacc_aseg', ...
        'lh_latorb_a2009s', ...
        'lh_wmmask_fs', ...
        'rh_supfront_a2009s', ...
        'lh_supfront_a2009s', ...
        'rh_ventraldc_aseg', ...
        'lh_ventraldc_aseg'};
%}        
for isubj = 1:length(subjects)
    roiPath = fullfile(datapath, subjects{isubj}, 'ROIs');
    for iroi = 1:length(rois)
        roi = fullfile(roiPath, [rois{iroi} '.mat']);
        outRoi = fullfile(roiPath, [rois{iroi} '_fd.mat']);
        smoothKernel = 0; % size of the 3D smoothing Kernel in mm
        %operations   = ['fillholes', 'dilate', 'removesat']; 
        operations   = [1, 1, 0]; 

        % fillholes = fill any hole in the ROI. Pass '' to not apply this
        %             operation
        % dilate     = expand the ROI in 3D. Pass '' to not apply this
        %             operation
        % removesat  = remove any voxel disconnected from the rest of the voxels. 
        %              Pass '' to not apply this operation
    
        oldRoiLoad = dtiReadRoi(roi);
        newRoi = dtiRoiClean(oldRoiLoad, smoothKernel, operations);
        dtiWriteRoi(newRoi, outRoi);
    end
end