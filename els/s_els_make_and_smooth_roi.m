function s_els_make_and_smooth_roi
%
% This script loads a NIFTI ROI, tranforms it into a mat ROI and 
% Applies some operations to it, such as smoothing, dilation and 
% removal of satellites.
%
% Copyright Franco Pestilli (c) Stanford University, 2014

datapath = '/media/lcne/matproc';

subjects = {'els049-T2'};

%subjects t2
%{
subjects =  {'els006-T2','els012-T2','els013-T2','els014-T2','els016-T2','els017-T2','els025-T2',...
             'els026-T2','els032x-T2','els042-T2','els047-T2','els048-T2','els049-T2','els050-T2', ...
             'els054-T2','els056-T2','els061-T2','els064-T2','els065-T2','els067-T2','els068-T2', ...
             'els069-T2','els070-T2','els081-T2','els087-T2','els089x-T2','els092-T2','els100-T2'};

'els006','els009','els012','els013','els014','els016','els017', ...
            'els024','els025','els026','els028','els032','els033','els034', ...
            'els039','els040','els041','els042','els045','els046','els047', ...
            'els048','els049','els050','els053','els054','els055','els056', ...
            'els057','els058','els059','els060','els061','els062','els064', ...
            'els065','els067','els068','els069','els070','els072','els073', ...
            'els074','els075','els076','els077','els079','els081','els083', ...
            'els085','els086','els087','els088','els089','els090'%
%}
        
rois = {'rh_nacc_aseg', ...
        'lh_nacc_aseg', ...
        'rh_frontorb_a2009s', ...
        'rh_frontinfang_a2009s', ...
        'rh_antins_a2009s', ...
        'rh_shortins_a2009s', ...
        'rh_nacc_aseg', ...
        'rh_latorb_a2009s', ...
        'rh_wmmask_fs', ...
        'lh_frontorb_a2009s', ...
        'lh_frontinfang_a2009s', ...
        'lh_antins_a2009s', ...
        'lh_shortins_a2009s', ...
        'lh_nacc_aseg', ...
        'lh_latorb_a2009s', ...
        'lh_wmmask_fs', ...
        'rh_supfront_a2009s', ...
        'lh_supfront_a2009s', ...
        'rh_ventraldc_aseg', ...
        'lh_ventraldc_aseg', ...
        'rh_amyg_aseg', ...
        'lh_amyg_aseg'};
     
for isubj = 1:length(subjects)
    roiPath = fullfile(datapath, subjects{isubj}, 'ROIs');
    for iroi = 1:length(rois)
        roi = fullfile(roiPath, [rois{iroi} '.mat']);
        outRoi = fullfile(roiPath, [rois{iroi} '_fd.mat']);
        smoothKernel = 0; % size of the 3D smoothing Kernel in mm
        %operations   = ['fillholes', 'dilate', 'removesat']; 
        operations   = [1, 1, 0]; 

        % fillholes = fill any hole in the ROI. Pass '' to not apply this
        %             operation
        % dilate     = expand the ROI in 3D. Pass '' to not apply this
        %             operation
        % removesat  = remove any voxel disconnected from the rest of the voxels. 
        %              Pass '' to not apply this operation
    
        oldRoiLoad = dtiReadRoi(roi);
        newRoi = dtiRoiClean(oldRoiLoad, smoothKernel, operations);
        dtiWriteRoi(newRoi, outRoi);
    end
end