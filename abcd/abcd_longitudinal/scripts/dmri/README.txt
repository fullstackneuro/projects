Description: This set of scripts is responsible for preprocessing subject diffusion data, as well as producing tracts between ROIs generated by the anat scripts.
It includes programs for untarring, b3000-shell data extraction, dtiInit, fiber tracking, fiber reorientation, and automated fiber cleaning.
The order of scripts provided here is strictly necessary. That is, each following script depends on outputs from the preceding script to function properly.
For a subject who has not yet been processed, the order of operations is as follows:


untar_dmri: This script takes three parameters which are available for editing up top.
	The tar path is the location of the subject's raw diffusion files (bvals, bvecs, and nifti file).
	The extract path is the location in which to place the raw files following untarring (should be bids).
	The subject list is a list of raw subject filenames to untar.
	Note that the subject list should be a column, delimited by new lines, containing names for the raw tar files (including the file extension) that you wish to extract.
	Running the script will create an extract (bids) directory for the diffusion data, and place the subject's diffusion files in a subject folder within that directory.

extract_3000shell_bvalvecs: The ABCD diffusion data is multi-shell, meaning that volumes were taken at varying magnetic field strengths.
	The processing we perform to extract tracts between ROIs takes single shell data. As such, we reduce the ABCD data to be single shell. This entails extracting only b0 volumes and b3000 volumes from the multishell data.
	This script is a wrapper for an R script which performs operations on the raw bval and bvec textfiles, isolating the indices for the volumes of interest, and modifying these files to be single-shell.
	You should not need to ever run th R script independently, but it is included in this scripts folder for inspection just in case.
	This script takes two parameters.
	The project path (projpath) is the location of the subject's bids folder.
	The text file is the file containing the list of subject raw files, indicating which subjects to run (same as for the untar_dmri script).
	Outputs of this script include a b3000 index file, as well as modified bval and bvec files containing only parameters for b0 and b3000 shell data. All outputs are placed in the bids folder.

extract 3000shell_vols: This script uses the index file generated by extract_3000shell_bvalvecs, and uses it to extract volumes from the raw diffusion nifti file containing b0 and b3000 shell data.
	The script takes three parameters.
	The out_dir is the directory in which to place preprocessed raw data, ready for dtiInit. This is the matproc folder, and is generated for the subject if it doesn't already exist.
	The input_dir is the location to look for subject fullshell raw data. This is generally the bids folder.
	The sub_list is the textfile containing a list of raw files indicating which subjects to run (see above).
	The output of this script is a nifti file containing only b0 and b3000 shell data, as well as modified bval and bvec files, placed in a raw subfolder under the subject's matproc folder.





********************************************************************************************************************************************************************************************************************************************************************************************************************************************
NOTE: THIS IS THE EXTENT OF SCRIPTS THAT CAN BE RUN BEFORE RUNNING ANATOMICAL PREPROCESSING. ALL THE FOLLOWING SCRIPTS REQUIRE SOME LEVEL OF ANATOMICAL OUTPUTS. DTIINIT REQUIRES THE ACPC-ALIGNED T1 FILE, AND TRACKING REQUIRES ROIS PRODUCED BOTH FROM FREESURFER AND FROM ANTS. REFER TO THE ANAT SCRIPTS FOLDER README FOR MORE INFORMATION.
**********************************************************************************************************************************************************************************************************************************************************************************************************************************





dtiInit: This script performs both csd and dtiInit operations on the modified single-shell raw diffusion data. 
	It is a wrapper for a matlab script. The matlab script contains preprocessing parameters that may need to be modified depending on the situation.
	The matlab script is available in this scripts folder for inspection and modification, should the need arise.
	This script takes three parameters.
	the bids directory is the location of the subject's bids folder, containing the output of acpc alignment.
	The matproc directory is the location of the subject's matproc folder, containing the modified single-shell raw diffusion data.
	The subfile is a text file containing a list of subject raw files, indicating which subjects you wish to process.
	Outputs of this script are the outputs of dtiInit, including the dt6 file, a dti trilin folder, and an ROIs folder.
	NOTE: This script requires that anat preprocessing has been run at least through acpc-alignment.

mrtrix_vta_ains_nacc: This script performs probabilistic tractography between the vta and nacc, as well as between the ains and nacc.
	It is a wrapper for a matlab script. The matlab script contains tracking parameters that may very well need to be modified depending on the situation.
	The matlab script is available in this scripts folder for inspection and modification, should the need arise.
	This script takes two parameters.
	The matproc directory is the location of the subject's matproc folder.
	The subfile is a text file containing a list of subject raw files, indicating which subjects you wish to process.
	Outputs of this script include an mrtrix folder under dtiXtrilin/fibers, as well as raw tract .pdb and .tck files for the vta-nacc and ains-nacc tracts.
	NOTE: Tracking can and often does fail, either resulting in no output fiber folders or fiber folders containing 0 fibers. 
	Probabilistic tractography can be finicky, and a failure in tracking likely indicates that you need to play around with the tracking parameters some, or visually inspect the ROIs to make sure nothing is amiss.
	NOTE: This script requires that anat preprocessing has been run through freesurfer segmentation, ANTs inverse transform, and ROI inflation and smoothing.

flip_and_clean_fibers: This script reorients the output raw fibers from mrtrix, ensuring that all fibers originate in the vta/ains and terminate in the nacc.
	It is a wrapper for four matlab scripts. These matlab scripts should not require modification, but are available in this scripts folder for inspection should the need arise.
	This script takes two parameters.
	The matproc directory is the location of the subjects' matproc folders.
	The subfile is a text file contaiining a list of subject raw files, indicating which subjects you wish to process.
	The four matlab scripts consist of two sets of two.
	The first two scripts reorient fibers for the vta-nacc and ains-nacc tracts, respectively.
	The second two scripts perform automated fiber pruning, removing fibers which deviate away from the central bundle by a significant margin.
	The outputs of this script are flipped raw tract files for vta-nacc and ains-nacc (indicated by flip in the filename), as well as outlier-pruned tract files for vta-nacc and ains-nacc (indicated by outlie in the filename).

create_tractprofiles: This script uses the outlie pruned tract files from mrtrix and uses them to compute average nodal values along the length of the tracts.
	It is a wrapper for a matlab script. This matlab script should not require modification, but is available in this scripts folder for inspection and editing should the need arise.
	This script takes four parameters.
	dtiDir is the directory containing the dt6 file and fibers folder, of the form "dtiXtrilin", where X is the number of directions.
	outDir is the output stats folder in which to save the resulting csv file. If this folder does not already exist, it is created.
	baseDir is the matproc directory, containing the outlie fiber files from which to compute tract metrics.
	txtfile is a list of subject raw files indicating which subjects to process.
	The output of this script is a single csv file, containing tract metrics for all subjects listed in the subject text file.
